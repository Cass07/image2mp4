<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>이미지를 동영상으로 변환</title>
</head>
<body>
<h1 style="text-align: center;">이미지를 1초 MP4로 변환</h1>
<div>
    <p style="text-align: left;font-size:0.8em;color:gray;">모든 프로세스는 브라우저에서 수행되며, 파일은 저장되지 않습니다.</p>
</div>
<input type="file" id="imageInput" accept="image/*" title="이미지 선택">
<button id="convertBtn">변환하기</button>
<span style="height:1em; display:block;"></span>
<video id="output" controls style="display:none; max-width: 100%;"></video>

<script>
    document.getElementById('convertBtn').addEventListener('click', async () => {
        const fileInput = document.getElementById('imageInput');
        const file = fileInput.files[0];

        if (!file) {
            alert('이미지를 선택해주세요');
            return;
        }

        // 이미지 로드
        const img = await loadImage(file);

        // Canvas 생성
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');

        // MediaRecorder로 녹화
        const stream = canvas.captureStream(15);
        const mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'video/mp4;codecs=avc1,mp4a.40.2',
            // 최대 500MB 파일을 생성할 수 있도록 비트레이트 설정
            videoBitsPerSecond: 400_000_000
        });

        const chunks = [];
        mediaRecorder.ondataavailable = (e) => chunks.push(e.data);

        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, {type: 'video/mp4'});
            const videoUrl = URL.createObjectURL(blob);

            const videoElement = document.getElementById('output');
            videoElement.src = videoUrl;
            videoElement.style.display = 'block';
        };

        // 녹화 시작
        mediaRecorder.start();

        // 1초 동안 이미지 그리기
        const fps = 15;
        const duration = 1000; // 1초
        let frame = 0;

        const interval = setInterval(() => {
            ctx.drawImage(img, 0, 0);
            frame++;

            if (frame >= fps) {
                clearInterval(interval);
                mediaRecorder.stop();
            }
        }, duration / fps);
    });

    function loadImage(file) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => resolve(img);
            img.onerror = reject;
            img.src = URL.createObjectURL(file);
        });
    }
</script>
</body>
</html>